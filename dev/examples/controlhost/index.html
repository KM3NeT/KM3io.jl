<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Accessing Live Data · KM3io.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="KM3io.jl logo"/></a><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/rootfiles/">ROOT Files</a></li><li><a class="tocitem" href="../../manual/detector/">Detector and its Components</a></li><li><a class="tocitem" href="../../manual/calibration/">Calibration</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../offline_data/">Offline data</a></li><li><a class="tocitem" href="../cherenkov_times/">Cherenkov times</a></li><li class="is-active"><a class="tocitem" href>Accessing Live Data</a><ul class="internal"><li><a class="tocitem" href="#Launching-JLigier"><span>Launching <code>JLigier</code></span></a></li><li><a class="tocitem" href="#Simulating-the-DAQ"><span>Simulating the DAQ</span></a></li><li><a class="tocitem" href="#Retrieving-Events"><span>Retrieving Events</span></a></li></ul></li><li><a class="tocitem" href="../hdf5/">Writing HDF5</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Accessing Live Data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Accessing Live Data</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://git.km3net.de/common/KM3io.jl/blob/main/docs/src/examples/controlhost.md#L" title="Edit source"><span class="docs-icon fa"></span><span class="docs-label is-hidden-touch">Edit source</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Accessing-Live-Data"><a class="docs-heading-anchor" href="#Accessing-Live-Data">Accessing Live Data</a><a id="Accessing-Live-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-Live-Data" title="Permalink"></a></h1><p>This example shows how to access and process live data (events) from the KM3NeT DAQ system. We will use two Jpp command line tools (<a href="https://common.pages.km3net.de/jpp/#JLigier"><code>JLigier</code></a> and <a href="https://common.pages.km3net.de/jpp/#JRegurgitate"><code>JRegurgitate</code></a>) to create a ligier dispatcher and send triggered DAQ events to it.</p><p>This example uses Jpp v14.4.3 and real data from a KM3NeT detector (online ROOT format) with the filename <code>KM3NeT_00000075_00010275.root</code> which can be found on the HPSS storage.</p><h2 id="Launching-JLigier"><a class="docs-heading-anchor" href="#Launching-JLigier">Launching <code>JLigier</code></a><a id="Launching-JLigier-1"></a><a class="docs-heading-anchor-permalink" href="#Launching-JLigier" title="Permalink"></a></h2><p>We open a terminal and launch the <code>JLigier</code> process with a high debug level. This ligier is the central communication point and it will receive messages which are tagged with short label of maximum 8 characters.</p><pre><code class="language-shell hljs">$ JLigier -P 5553 -d 3
Port              5553
Memory limit 16760735744
Queue  limit        100</code></pre><p>The ligier is now running and and listening on port 5553 of all host IP addresses (including the localhost <code>127.0.0.1</code>). Clients can connect to it and subscribe for a given set of message tags. Leave this terminal open.</p><h2 id="Simulating-the-DAQ"><a class="docs-heading-anchor" href="#Simulating-the-DAQ">Simulating the DAQ</a><a id="Simulating-the-DAQ-1"></a><a class="docs-heading-anchor-permalink" href="#Simulating-the-DAQ" title="Permalink"></a></h2><p>The first client we start in new terminal session is the <a href="https://common.pages.km3net.de/jpp/#JRegurgitate"><code>JRegurgitate</code></a> process which takes a ROOT file (in online format), a class identifier, a few other parameters like the frequency and timeout of the messages and also the IP and port of the ligier to send to. We will use this application to simulate the KM3NeT DAQ – at least the output of the <a href="https://common.pages.km3net.de/jpp/#JDataFilter"><code>JDataFilter</code></a> which is responsible for triggering events and sending them downstreams to a <code>JLigier</code> so that they can be picked up by the <a href="https://common.pages.km3net.de/jpp/#JDataWriter"><code>JDataWriter</code></a> to store them in  <a href="../../manual/rootfiles/#online_dataformat">ROOT files (online format)</a>.</p><pre><code class="language-shell hljs">$ JRegurgitate -f /data/sea/KM3NeT_00000075_00010275.root -C JDAQEvent -R 2 -T 10000000 -H 127.0.0.1:5553</code></pre><p>This program is fairly quite but if you look at the terminal where the <code>JLigier</code> is running, you&#39;ll see a flood of messages, showing that a new client has connected and data is received (tagged with <code>IO_EVT</code>). It also prints the number of bytes of each message:</p><pre><code class="language-shell hljs">$ JLigier -P 5553 -d 3
Port              30001
Memory limit 16760735744
Queue  limit        100
New client[4]
Client[4].read(0,1,1756)
Client[4].read(1,2,0)
Message[4] IO_EVT 1772
Client[4].read(0,1,1394)
Client[4].read(1,2,0)
Message[4] IO_EVT 1410
Client[4].read(0,1,1716)
...
...
...</code></pre><h2 id="Retrieving-Events"><a class="docs-heading-anchor" href="#Retrieving-Events">Retrieving Events</a><a id="Retrieving-Events-1"></a><a class="docs-heading-anchor-permalink" href="#Retrieving-Events" title="Permalink"></a></h2><p>Now open a thrid terminal and fire up the Julia REPL. With a few lines, we will able to connect to the ligier and receive DAQ events interactively.</p><pre><code class="language-julia-repl hljs">julia&gt; using KM3io

julia&gt; c = CHClient{KM3io.DAQEvent}(ip&quot;127.0.0.1&quot;, 5553)
CHClient{DAQEvent}(ip&quot;127.0.0.1&quot;, 0x7531, CHTag[CHTag(&quot;IO_EVT&quot;)], Sockets.TCPSocket(RawFD(20) open, 0 bytes waiting))

julia&gt; for e in c
         @show e
       end
e = DAQEvent with 126 snapshot and 7 triggered hits
e = DAQEvent with 138 snapshot and 6 triggered hits
e = DAQEvent with 149 snapshot and 6 triggered hits
e = DAQEvent with 149 snapshot and 6 triggered hits
e = DAQEvent with 136 snapshot and 6 triggered hits
...
...
...</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../cherenkov_times/">« Cherenkov times</a><a class="docs-footer-nextpage" href="../hdf5/">Writing HDF5 »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Tuesday 23 May 2023 08:58">Tuesday 23 May 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
