<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Cherenkov times · KM3io.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="KM3io.jl logo"/></a><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/rootfiles/">ROOT Files</a></li><li><a class="tocitem" href="../../manual/detector/">Detector and its Components</a></li><li><a class="tocitem" href="../../manual/calibration/">Calibration</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../offline_data/">Offline data</a></li><li class="is-active"><a class="tocitem" href>Cherenkov times</a></li><li><a class="tocitem" href="../controlhost/">Accessing Live Data</a></li><li><a class="tocitem" href="../hdf5/">Writing HDF5</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Cherenkov times</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Cherenkov times</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://git.km3net.de/common/KM3io.jl/blob/main/docs/src/examples/cherenkov_times.md#L" title="Edit source"><span class="docs-icon fa"></span><span class="docs-label is-hidden-touch">Edit source</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Cherenkov-times"><a class="docs-heading-anchor" href="#Cherenkov-times">Cherenkov times</a><a id="Cherenkov-times-1"></a><a class="docs-heading-anchor-permalink" href="#Cherenkov-times" title="Permalink"></a></h1><p>In this example, we will pick the best reconstructed muon (from the Jpp muon reconstruction chain <code>JMuon</code>) in each event and calculate the Cherenkov hit time residuals for each triggered hit.</p><p>We open the a sample file from the <code>KM3NeTTestData</code> package:</p><pre><code class="language-julia hljs">using KM3io, KM3NeTTestData

f = ROOTFile(datapath(&quot;offline&quot;, &quot;mcv6.0.gsg_muon_highE-CC_50-500GeV.km3sim.jterbr00008357.jorcarec.aanet.905.root&quot;))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ROOTFile{OfflineTree (140 events)}</code></pre><p>Each event holds a vector of reconstructed tracks (<code>Vector{Trk}</code>) behind the <code>.trks</code> field. This vector contains different stages of reconstruction results from a variety of reconstruction algorithms (<code>JMuon</code>, <code>JShower</code>, <code>aashower</code> etc.). <code>KM3io.jl</code> exports helper functions to pick the best reconstructed track for a given reconstruction algorithm. The logic is based on the reference implementation in <a href="https://git.km3net.de/common/km3net-dataformat/-/blob/master/tools/reconstruction.hh">KM3NeT DataFormat tools</a>. The function <code>bestjppmuon()</code> can be used to select the best reconstructed <code>JMuon</code> for a given event:</p><pre><code class="language-julia hljs">evt = f.offline[1]
best_muon = bestjppmuon(evt)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Trk(1, [472.38683488288035, 526.1421552520982, 198.52185151902515], [0.14146977403136585, 0.9861486218588713, 0.0865863652162581], 5.8796099548102595e7, 544.9525806125414, 0.0, 40.55672709261793, 4000, Int32[1, 2, 5, 3, 5, 4], [0.014885871185356527, 0.010385140089653992, -40.55672709261793, 21.0, 544.9525806125414, 62.53353460788458, 3.9927948910593534, 14.0, 0.0, 8.658344340729155, 45.03600640024326, 0.0, 0.0, 1501.6459845444228, -60.9373245973645, 602.0, 18.0])</code></pre><p>We now use this track as a seed to calculate the Cherenkov photon (see <a href="../../api/#KM3io.CherenkovPhoton"><code>CherenkovPhoton</code></a>) parameters using <a href="../../api/#KM3io.cherenkov"><code>cherenkov()</code></a> for each hit triggered hit in the event. To select only triggered hits, we use the <a href="../../api/#KM3io.triggered"><code>triggered()</code></a> function together withe <code>filter()</code> which returns a new vector of triggered hits:</p><pre><code class="language-julia hljs">cherenkov(best_muon, filter(triggered, evt.hits))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">18-element Vector{CherenkovPhoton}:
 CherenkovPhoton(27.456056524385705, 40.873619315665835, 23.01132932189433, 5.879636441354458e7, -3.3185445815324783, -0.6308750235550007, [-0.5280726983220052, 0.8386645132949296, -0.1333456389489177])
 CherenkovPhoton(19.58954108346994, 29.162798528739586, 34.06689497770607, 5.879634739559217e7, -3.233592174947262, -0.5615835242962761, [-0.10332584557538863, 0.815965010737073, -0.5687924673279168])
 CherenkovPhoton(10.86335249693419, 16.17218896884211, 44.610162820726416, 5.879632277897501e7, -13.470975004136562, -0.7747565822537268, [-0.2741635374885427, 0.8327626017287887, -0.48097900564750967])
 CherenkovPhoton(10.95865811567447, 16.314069707453438, 44.59234480366249, 5.879632337250174e7, -12.580501735210419, -0.12671424342178972, [-0.26996965838456793, 0.8324204577911081, -0.4839344635408413])
 CherenkovPhoton(10.944182695875304, 16.29252026178632, 44.40568465253136, 5.879632265069598e7, 3.0913040190935135, -0.9323746132442533, [-0.28061324969503537, 0.8332805365263898, -0.4763399537534972])
 CherenkovPhoton(11.17928745250317, 16.642518897357846, 44.22007515662778, 5.8796323642327406e7, 15.824672594666481, 0.13091951330569712, [-0.28166643233811883, 0.8333641475329505, -0.47557146518750953])
 CherenkovPhoton(10.90295605293336, 16.23114647681559, 44.79747555408915, 5.8796323675116315e7, 23.333883680403233, 0.21074029444645023, [-0.27966746730903425, 0.8332052197790003, -0.4770274305131501])
 CherenkovPhoton(10.834690812223194, 16.129520540155625, 44.74122710381231, 5.879632301979044e7, 35.40920955687761, -0.5058063194444703, [-0.2759143497206357, 0.8329041936340709, -0.4797310453212477])
 CherenkovPhoton(38.84032185176909, 57.82128719239538, -7.3748303011806655, 5.879634105250908e7, 2.452490918338299, -0.869871832680696, [-0.49768036486114947, 0.8411698501975048, -0.21153613769372911])
 CherenkovPhoton(28.22562353198971, 42.01926777682648, 4.187186042072117, 5.879630689544618e7, 0.01255381852388382, 0.010809985106091385, [-0.20536281574231854, 0.826660216630483, -0.5238883470271404])
 CherenkovPhoton(14.785344110263079, 22.01082759562596, 20.557497574678035, 5.8796269418408036e7, 1.031591959297657, -0.8687222096306455, [-0.49539706637778913, 0.8412721768556203, -0.2164321396486352])
 CherenkovPhoton(14.88094434135218, 22.153146921365803, 20.51061784167785, 5.879626991701378e7, 6.563986226916313, -0.3270806917438915, [-0.49376584703803356, 0.8413399367600128, -0.21986904991715162])
 CherenkovPhoton(15.035038797101658, 22.382546147629952, 20.413422353617566, 5.8796270648541935e7, 10.363458067178726, 0.45681008948052304, [-0.49501594042850555, 0.841288399552909, -0.21723960849575105])
 CherenkovPhoton(35.48962576204839, 52.8331317997193, -2.014094840107113, 5.879633597758977e7, 1.9564102292060852, -0.4138351012632555, [0.2341920351405915, 0.7697450484845674, -0.5938405939393154])
 CherenkovPhoton(35.322525552364354, 52.584371008011026, -1.7938275339033467, 5.879633556747952e7, 3.269520476460457, -0.8429145215271237, [0.2345171627347877, 0.7696930575084194, -0.5937796709269915])
 CherenkovPhoton(25.877763469142074, 38.52402663285318, 9.45499183787367, 5.8796308381212674e7, -0.5812126770615578, -0.9686719491474437, [0.27451879989430933, 0.7631813220745428, -0.5849732456626894])
 CherenkovPhoton(26.084505456694867, 38.83180183313701, 9.19462645688342, 5.8796308929165296e7, 2.361834704875946, -0.39414201377088814, [0.2777981674998186, 0.7626371978873142, -0.5841341306004368])
 CherenkovPhoton(17.507053914837183, 26.062615963014824, 19.40524417300148, 5.8796284221979275e7, 1.8830207213759422, -0.9165095376090591, [0.3547191740867844, 0.7494025149884511, -0.5590797600201369])</code></pre><p>To obtain more statistics, we iterate through all the events and calculate the Cherenkov time residuals for each set of hits based on the best reconstruction track. We fill the time residuals in a 1D histogram using the <a href="https://github.com/Moelf/FHist.jl">FHist</a> package.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This example uses <a href="https://github.com/KristofferC/PGFPlotsX.jl">PGFPlotsX</a> which is a wrapper for the LaTeX library PGFPlots. Feel free to adapt the example to use your favourite plotting library.</p></div></div><pre><code class="language-julia hljs">using FHist

Δts = Hist1D(;bins=-10:50)

for evt ∈ f.offline
    m = bestjppmuon(evt)
    cherenkov_photons = cherenkov(m, filter(triggered, evt.hits))
    for cp ∈ cherenkov_photons
        push!(Δts, cp.Δt)
    end
end

axis = @pgf Axis(
    {
        ybar, const_plot, grid,
        xlabel=raw&quot;\Delta t / ns&quot;,
        ylabel=&quot;counts&quot;,
    },
    PlotInc(Coordinates(bincenters(Δts), bincounts(Δts)), raw&quot;\closedcycle&quot;)
)
axis</code></pre><p><a href="../cherenkov.pdf">[.pdf]</a>, <a href="../cherenkov.tex">[generated .tex]</a></p><p><img src="../cherenkov.svg" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../offline_data/">« Offline data</a><a class="docs-footer-nextpage" href="../controlhost/">Accessing Live Data »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Tuesday 13 June 2023 17:53">Tuesday 13 June 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
